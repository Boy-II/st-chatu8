# SillyTavern 文生图 (st-chatu8)

**作者:** 从前跟你一样
**版本:** 1.0.0

这是一个为 [SillyTavern](https://github.com/SillyTavern/SillyTavern) 设计的第三方扩展，它将强大的文生图功能无缝集成到您的聊天体验中。通过简单的标记，您可以在对话中直接调用 Stable Diffusion、NovelAI 或 ComfyUI，将文字描述变为生动的图像。

## ✨ 功能

- **多后端支持**:
    - **Stable Diffusion**: 通过 A1111/Forge WebUI API 连接。
    - **NovelAI**: 支持官方及第三方 NovelAI API。
    - **ComfyUI**: 通过导入工作流 (Workflow) 实现高度自定义的图像生成。
- **简单易用的触发方式**: 在聊天中用自定义的开始和结束标记（如 `[prompt]`）包裹提示词，即可自动生成图片。
- **高度可配置**:
    - **全局设置**: 在多种后端之间轻松切换，并配置全局触发标记。
    - **精细化参数**: 为每个后端（SD, NovelAI, ComfyUI）分别设置模型、采样器、尺寸、步数、CFG 等详细参数。
    - **高级功能**: 支持 SD 的高清修复 (Hires. fix)、ADetailer；支持 NovelAI 的氛围参考 (Vibe Transfer)、角色参考 (Character Reference)；支持 ComfyUI 的 LORA 和自定义工作流。
- **提示词管理**:
    - **固定提示词**: 为每个后端设置固定的正面和负面提示词。
    - **提示词预设**: 保存和加载多套提示词配置，方便在不同风格间切换。
    - **动态替换**: 设置规则，自动将聊天中的特定词语替换为更适合绘画的提示词。
- **用户体验优化**:
    - **图片缓存**: 内置图片缓存系统，可预览、管理和下载生成的图片，并设置缓存有效期。
    - **便捷操作**: 支持长按图片修改提示词、双击图片重新生成。
    - **界面集成**: 在主界面添加设置入口，并提供可自定义的悬浮球按钮。
    - **自动更新**: 启动时自动检查并提示插件更新。

## 🚀 安装

1.  在 SillyTavern 的扩展菜单中，从以下 URL 安装插件：
    ```
    https://github.com/damoshen123/st-chatu8
    ```
2.  重启 SillyTavern。
3.  在扩展菜单中启用 "st-chatu8"。

## 📖 使用方法

核心使用流程非常简单：

### 1. 打开设置面板

点击侧边栏的 **“打开文生图设置”** 按钮，或通过悬浮球进入插件的设置面板。

### 2. 配置后端

-   在 **“主要设置”** 标签页中，选择您希望使用的 **模式** (SD / NovelAI / ComfyUI)。
-   切换到对应后端的标签页 (例如 "SD")，填入您的 API 地址 (如 `http://127.0.0.1:7860`)，并点击 **“测试连接”** 确保插件可以正常通信。
-   根据您的需求，配置模型、采样器、默认尺寸等参数。

### 3. 在聊天中生成图片

在任意聊天消息中，使用您在 **“主要设置” -> “标记”** 中定义的 **开始标记** 和 **结束标记** (默认为 `[` 和 `]`) 来包裹您的绘图提示词。

**示例:**

```
[1girl, solo, beautiful detailed eyes, looking at viewer]
```

插件会自动检测到这段内容，调用您选择的后端，并将生成的图片显示在聊天界面中。

## ⚙️ 设置选项

插件提供了丰富的设置选项，分布在不同的标签页中：

### 主要设置

-   **启用插件**: 插件的总开关。
-   **模式**: 选择默认使用的文生图后端 (SD, NovelAI, ComfyUI)。
-   **标记**: 自定义用于触发图片生成的开始和结束符号。
-   **缓存管理**: 设置图片缓存的有效期，或一键清除所有缓存。

### SD / NovelAI / ComfyUI 标签页

每个后端都有独立的配置页面，通常包括：

-   **API 地址**: 连接后端服务的 URL。
-   **固定提示词**: 设置全局的正面和负面提示词，支持预设管理。
-   **提示词替换**: 定义规则，将特定文本替换为其他内容 (例如 `马` -> `horse`)。
-   **质量预设**: 快速启用/禁用通用的高质量或低质量提示词。
-   **生成参数**:
    -   模型 (Model), VAE, 采样器 (Sampler), 调度器 (Scheduler)
    -   图片宽度 (Width) 和高度 (Height)
    -   采样步数 (Steps), CFG 缩放
    -   种子 (Seed)
-   **高级选项**:
    -   **SD**: 高清修复、面部修复 (Restore Faces)、ADetailer。
    -   **NovelAI**: SMEA, Vibe Transfer, Character Reference 等。
    -   **ComfyUI**: 工作流 (Workflow) 管理，允许您粘贴从 ComfyUI 导出的 API JSON。

### 其他标签页

-   **主题设置**: 自定义设置面板的颜色主题。
-   **悬浮球**: 配置悬浮球的开关、样式和大小。
-   **图片缓存**: 查看和管理所有已生成的图片。
-   **关于**: 查看插件信息、检查更新以及获取帮助。

---
享受在 SillyTavern 中自由创作的乐趣吧！

## 帮助与支持

-   [飞书文档](https://gxcgf4l6b2y.feishu.cn/docx/XDo7dLpvhov6AexuLu3c8mpynSC?from=from_copylink)
-   [投喂作者](https://afdian.com/a/cqgnyy)

## 许可证

-   [Aladdin](LICENSE)
